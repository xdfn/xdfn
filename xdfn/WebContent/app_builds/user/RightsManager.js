Ext.define("xdfn.user.RightsManager",{extend:"xdfn.user.ui.RightsManager",initComponent:function(){var a=this;a.rightStore=Ext.create("xdfn.user.store.RightsJsonStore");a.userStore=Ext.create("xdfn.user.store.UserJsonStore");a.userightStore=Ext.create("xdfn.user.store.UserRightsJsonStore");a.callParent(arguments);a.down('button[text="增加权限"]').on("click",a.OnAddRightsBtnClick,a);a.down('button[text="删除权限"]').on("click",a.OnDeleteRightsBtnClick,a);a.down('button[text="查找"]').on("click",a.OnSearchBtnClick,a);a.down('button[text="重置"]').on("click",a.OnResetBtnClick,a);a.down('button[text="刷新"]').on("click",a.OnRefreshBtnClick,a);a.down("#UserGrid").on("select",a.OnUserGridSelect,a);a.down("#RightGrid").on("select",a.OnRightsGridSelect,a);a.userStore.on("load",a.OnUserStoreLoad,a)},OnUserStoreLoad:function(b,a,e,c){var d=this;Ext.apply(d.userightStore.getProxy(),{extraParams:{}});d.userightStore.loadRawData([])},OnAddRightsBtnClick:function(a,f,b){var c=this,g=c.down("#UserGrid").getSelectionModel().getSelection(),d=c.down("#RightGrid").getSelectionModel().getSelection();xdfn.user.Rights.hasRights("XTGL-QXGL-2",function(){if(g.length>0&&d.length>0){var e=[];Ext.each(d,function(h){e.push(h.get("ID_VIEW"))});Ext.Ajax.request({url:"./userManage.do?method=addUserRights",method:"get",params:{V_RIGHT_ID:Ext.encode(e),V_USER_FK:g[0].get("V_USER_FK_VIEW")},success:function(h,i){c.rightStore.remove(d);c.userightStore.load();Ext.Msg.alert("提示","增加权限成功！")},failure:function(h,i){Ext.Msg.alert("提示","请求失败！")}})}else{Ext.Msg.alert("提示","请先选择相应的员工和权限！")}})},OnDeleteRightsBtnClick:function(i,f,j){var g=this,a=i.up("gridpanel"),h=a.getStore(),d=a.getSelectionModel(),c=d.getSelection(),b=g.down("#UserGrid").getSelectionModel().getSelection();xdfn.user.Rights.hasRights("XTGL-QXGL-3",function(){if(b.length>0&&c.length>0){Ext.MessageBox.confirm("提示","确定删除选择的用户权限吗？",function(k){if(k=="yes"){var e=[];Ext.each(c,function(l){e.push(l.get("ID_VIEW"))});Ext.Ajax.request({url:"./userManage.do?method=delUserRights",method:"get",params:{ID:Ext.encode(e),V_USER_FK:b[0].get("V_USER_FK_VIEW")},success:function(l,m){g.userightStore.load();Ext.Msg.alert("提示","删除权限成功！")},failure:function(l,m){Ext.Msg.alert("提示","请求失败！")}})}})}else{Ext.Msg.alert("提示","请选择要删除的用户权限！")}})},OnUserGridSelect:function(e,a,b,c){var d=this;Ext.apply(d.userightStore.getProxy(),{extraParams:{V_USER_FK:a.get("V_USER_FK_VIEW")}});d.userightStore.load()},OnRightsGridSelect:function(e,a,b,c){var d=this},OnSearchBtnClick:function(a,f,b){var d=this;var c=a.up("form").getForm();if(!c.isValid()){return}Ext.apply(d.userStore.getProxy(),{extraParams:c.getValues()});d.userStore.load()},OnResetBtnClick:function(a,c,b){a.up("form").getForm().reset()},OnRefreshBtnClick:function(a,d,b){var c=this;c.rightStore.load()}});