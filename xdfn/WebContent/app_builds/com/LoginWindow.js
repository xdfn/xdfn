Ext.define("xdfn.com.LoginWindow",{extend:"xdfn.com.ui.LoginWindow",initComponent:function(){var a=this;a.callParent(arguments);a.down('button[text="登录"]').on("click",a.OnLoginBtnClick,a);a.down('button[text="退出"]').on("click",a.OnExitSysBtnClick,a);a.down('textfield[name="V_USER_ACC"]').on("keypress",a.OnUserAccKeyPress,a);a.down('textfield[name="V_PASSWORD"]').on("keypress",a.OnLoginBtnKeyPress,a);Ext.Ajax.request({url:"./login.do?method=isLogin",success:function(d,e){var c=Ext.JSON.decode(d.responseText);if(c.IS_LOGINED){var b=Ext.create("xdfn.com.XdfnViewport",{renderTo:Ext.getBody()});Ext.apply(b,{welcome:c.V_USER_NAME});b.show();a.close()}else{a.show().down('textfield[name="V_USER_ACC"]').focus(true,10)}},failure:function(b,c){Ext.Msg.alert("提示","无法访问！");a.close()}})},OnLoginBtnKeyPress:function(a,d,b){var c=this;if(d.getKey()==d.ENTER){c.down('button[text="登录"]').fireEvent("click")}},OnUserAccKeyPress:function(a,d,b){var c=this;if(d.getKey()==d.ENTER){c.down('textfield[name="V_PASSWORD"]').focus()}},OnLoginBtnClick:function(a,d,b){var c=this;var f=c.down("form").getForm();if(!f.isValid()){return}f.submit({clientValidtion:true,waitMsg:"正在验证登录信息，请稍后",waitTitle:"提示",url:"./login.do?method=login",method:"post",success:function(g,h){c.close();var e=Ext.create("xdfn.com.XdfnViewport",{renderTo:Ext.getBody()});Ext.apply(e,{welcome:h.result.V_USER_NAME});e.show()},failure:function(e,g){Ext.Msg.alert("提示",g.result.msg)}})},OnExitSysBtnClick:function(a,d,b){var c=this;c.close()}});