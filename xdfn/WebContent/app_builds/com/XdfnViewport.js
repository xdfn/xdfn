Ext.define("xdfn.com.XdfnViewport",{extend:"xdfn.com.ui.XdfnViewport",initComponent:function(){var a=this;a.callParent(arguments);Ext.require(["xdfn.ux.grid.Printer","Ext.ux.exporter.Exporter","Ext.ux.form.field.ComboBoxTree","xdfn.user.Rights"]);Ext.util.Format.decimalSeparator=".";Ext.util.Format.thousandSeparator=",";a.down("#PersonPadTree").on("itemclick",a.onPersonPadItemClick,a);a.down("#InfoCenterTree").on("itemclick",a.onInfoCenterItemClick,a);a.down("#ProjectMgrTree").on("itemclick",a.onProjectMgrItemClick,a);a.down("#ServiceMgrTree").on("itemclick",a.onServiceMgrItemClick,a);a.down("#CustomerMgrTree").on("itemclick",a.onCustomerMgrItemClick,a);a.down("#SysMgrTree").on("itemclick",a.onSysMgrItemClick,a);a.tabPanel=Ext.getCmp("xdfnTabPanel");a.tabPanel.setActiveTab(a.tabPanel.add(Ext.create("xdfn.person.PersonPad")));a.createAllStaticStore();Ext.apply(Ext.form.field.VTypes,{dateRange:function(f,h){var e=null,c=null,g=null,i=null,b=true,d=h.dateRange.parent;if(h.dateRange){if(!Ext.isEmpty(h.dateRange.begin)){c=d.down('datefield[name="'+h.dateRange.begin+'"]');e=c.getValue()}if(!Ext.isEmpty(h.dateRange.end)){i=d.down('datefield[name="'+h.dateRange.end+'"]');g=i.getValue()}}if(!Ext.isEmpty(e)&&!Ext.isEmpty(g)){b=e<=g}return b},dateRangeText:"起始日期不能大于结束日期，请重新选择！"})},show:function(b,a){var b=this;b.setWelcomeInfo();b.createClock();b.registerQuickTip()},createAllStaticStore:function(){Ext.regModel("Combox",{fields:[{name:"V_COMBOX_NAME_VIEW",type:"string"},{name:"V_COMBOX_VALUE_VIEW",type:"string"}]});Ext.create("xdfn.com.store.DeptDutyTreeStore",{storeId:"DeptDutyTreeStore",proxy:{type:"ajax",url:"./deptManage.do?method=getList&node=root",reader:{type:"json"}}});Ext.create("xdfn.com.store.ComboTreeStore",{storeId:"ZoneTreeStore",proxy:{type:"ajax",url:"data/zone.json",reader:{type:"json"}}});Ext.create("xdfn.com.store.ComboTreeStore",{storeId:"EmployeeTreeStore",proxy:{type:"ajax",url:"./deptManage.do?method=getInnerList&node=root",reader:{type:"json"}}});Ext.create("xdfn.com.store.ComboTreeStore",{storeId:"BansTreeStore",proxy:{type:"ajax",url:"./deptManage.do?method=getZwbList&node=root",reader:{type:"json"}}});Ext.create("xdfn.com.store.CustListJsonStore",{id:"ProjListJsonStore",proxy:{type:"ajax",url:"./projectMgr.do?method=getProjectCombox",reader:{type:"json",root:"data"}}});Ext.create("xdfn.com.store.CustListJsonStore",{id:"ClientListJsonStore",proxy:{type:"ajax",url:"./cusManage.do?method=getCusListByTypeBelong&typeBelong=client",reader:{type:"json",root:"data"}}});Ext.create("xdfn.com.store.CustListJsonStore",{id:"DesignListJsonStore",proxy:{type:"ajax",url:"./cusManage.do?method=getCusListByTypeBelong&typeBelong=design",reader:{type:"json",root:"data"}}});new Ext.data.ArrayStore({model:"Combox",storeId:"ShiyouStore",data:[["办公","办公"],["集团","集团"],["会议","会议"],["招待","招待"],["出差","出差"],["请假","请假"],["加班","加班"],["其他","其他"]]});new Ext.data.ArrayStore({model:"Combox",storeId:"ScheduleBelongStore",data:[["项目","项目"],["售后服务","售后服务"],["回款","回款"],["其他","其他"]]});new Ext.data.ArrayStore({model:"Combox",storeId:"ScheduleLevelStore",data:[["紧急","紧急"],["一般","一般"]]});new Ext.data.ArrayStore({model:"Combox",storeId:"ReportStore",data:[["总经理","总经理"],["副总经理","副总经理"],["处级","处级"],["科级","科级"],["个人","个人"]]});new Ext.data.ArrayStore({model:"Combox",storeId:"FinishStore",data:[["已完成","已完成"],["未完成","未完成"]]});new Ext.data.ArrayStore({model:"Combox",storeId:"CustomBelongStore",data:[["风电场业主","风电场业主"],["设计院","设计院"],["供货商","供货商"],["政府机关","政府机关"],["研究和资讯机构","研究和资讯机构"],["电网公司","电网公司"],["竞争对手","竞争对手"],["其他","其他"]]});new Ext.data.ArrayStore({model:"Combox",storeId:"TradeTypeStore",data:[["国有企业","国有企业"],["民营企业","民营企业"],["外资企业","外资企业"],["合资企业","合资企业"],["其他","其他"]]});new Ext.data.ArrayStore({model:"Combox",storeId:"CustomPhaseStore",data:[["潜在客户","潜在客户"],["新客户","新客户"],["老客户","老客户"]]});new Ext.data.ArrayStore({model:"Combox",storeId:"CustomLevelStore",data:[["信用等级A","信用等级A"],["信用等级B","信用等级B"],["信用等级C","信用等级C"],["信用等级D","信用等级D"],["信用等级E","信用等级E"]]});new Ext.data.ArrayStore({model:"Combox",storeId:"FaxTypeStore",data:[["重要传真","重要传真"],["一般传真","一般传真"],["项目传真","项目传真"]]});new Ext.data.ArrayStore({model:"Combox",storeId:"RecLevelStore",data:[["高级","高级"],["一般","一般"]]});new Ext.data.ArrayStore({model:"Combox",storeId:"ProjSourceStore",data:[["本部","本部"],["驻外办","驻外办"]]});new Ext.data.ArrayStore({model:"Combox",storeId:"ProjTypeStore",data:[["国内项目","国内项目"],["国外项目","国外项目"]]});new Ext.data.ArrayStore({model:"Combox",storeId:"ProjPhaseStore",data:[["项目预报","项目预报"],["项目跟进","项目跟进"],["重点项目","重点项目"],["项目投标","项目投标"],["项目不投标","项目不投标"],["项目中标","项目中标"],["项目失标","项目失标"],["合同管理","合同管理"],["合同执行","合同执行"],["合同废除","合同废除"],["过240","过240"],["质保期","质保期"],["已过质保期","已过质保期"]]});new Ext.data.ArrayStore({model:"Combox",storeId:"ProjReviewStore",data:[["风资源评估","风资源评估"],["预可行性研究","预可行性研究"],["可行性研究","可行性研究"],["项目立项","项目立项"],["项目核准","项目核准"]]});new Ext.data.ArrayStore({model:"Combox",storeId:"WindTypeStore",data:[["陆地平原","陆地平原"],["陆地山地","陆地山地"],["陆地高原","陆地高原"],["潮间带","潮间带"],["浅海","浅海"],["近海","近海"]]});new Ext.data.ArrayStore({model:"Combox",storeId:"ServiceStatusStore",data:[["未处理","未处理"],["处理中","处理中"],["已处理","已处理"],["需领导协调解决","需领导协调解决"],["无法解决","无法解决"]]});new Ext.data.ArrayStore({model:"Combox",storeId:"ProjFollowTypeStore",data:[["商务交流","商务交流"],["技术交流","技术交流"],["项目策划","项目策划"],["中标总结","中标总结"],["失标总结","失标总结"],["不投标总结","不投标总结"],["其他","其他"]]});new Ext.data.ArrayStore({model:"Combox",storeId:"FilesTypeStore",data:[["技术文档","技术文档"],["技术图纸","技术图纸"],["其他","其他"]]})},registerQuickTip:function(){Ext.tip.QuickTipManager.register({target:Ext.get("DatetimeView"),text:Ext.Date.format(new Date(),"公元Y年n月j日")})},setWelcomeInfo:function(){var c=this;var a=new Date();var b=a.getHours();if(b>6&&b<8){c.welcome="早上好，"+c.welcome}else{if(b>=8&&b<12){c.welcome="上午好，"+c.welcome}else{if(b>=12&&b<19){c.welcome="下午好，"+c.welcome}else{c.welcome="晚上好，"+c.welcome}}}Ext.fly("WelcomeId").dom.innerHTML=c.welcome;var e=Ext.create("Ext.Img",{src:"resources/images/menu_sys_help_gray.png",renderTo:Ext.fly("HelpId")});Ext.fly("HelpId").on({mouseover:{fn:function(){e.setSrc("resources/images/menu_sys_help.png")}},mouseout:{fn:function(){e.setSrc("resources/images/menu_sys_help_gray.png")}},click:{fn:function(){var f=Ext.create("xdfn.com.AboutWindow");f.show()}},scope:this});var d=Ext.create("Ext.Img",{src:"resources/images/menu_sys_exit_gray.png",renderTo:Ext.fly("ExitSysId")});Ext.fly("ExitSysId").on({mouseover:{fn:function(){d.setSrc("resources/images/menu_sys_exit.png")}},mouseout:{fn:function(){d.setSrc("resources/images/menu_sys_exit_gray.png")}},click:{fn:function(){Ext.MessageBox.confirm("提示","确定退出系统吗？",function(f){if(f=="yes"){Ext.Ajax.request({url:"./login.do?method=logout",success:function(h,i){var g=Ext.JSON.decode(h.responseText);if(g.IS_LOGOUT){location.href="./"}else{Ext.MessageBox.alert("提示","注销失败，请重试！")}},failure:function(g,h){Ext.Msg.alert("提示","无法访问！")}})}})}},scope:this});Ext.fly("DateId").dom.innerHTML=Ext.Date.format(new Date(),"m/d");Ext.fly("WeekId").dom.innerHTML=c.getDayOfWeek()},createClock:function(){var a={run:function(){Ext.fly("TimeId").dom.innerHTML=Ext.Date.format(new Date(),"G:i:s")},interval:1000};var b=new Ext.util.TaskRunner();b.start(a)},getDayOfWeek:function(){var a="",b=new Date();switch(b.getDay()){case 0:a="周日";break;case 1:a="周一";break;case 2:a="周二";break;case 3:a="周三";break;case 4:a="周四";break;case 5:a="周五";break;case 6:a="周六";break}return a},onPersonPadItemClick:function(b,a,g,d,h,c){var f=this;switch(d){case 0:var i=Ext.getCmp("PersonPad");f.tabPanel.setActiveTab(i);break;case 1:xdfn.user.Rights.hasRights("GRPT-GRXX-1",function(){var e=Ext.getCmp("PersonInfo");if(e==undefined){f.tabPanel.setActiveTab(f.tabPanel.add(Ext.create("xdfn.person.PersonInfo")))}else{f.tabPanel.setActiveTab(e)}});break;case 2:xdfn.user.Rights.hasRights("GRPT-GRRC-1",function(){var e=Ext.getCmp("PersonSchedule");if(e==undefined){f.tabPanel.setActiveTab(f.tabPanel.add(Ext.create("xdfn.person.PersonSchedule")))}else{f.tabPanel.setActiveTab(e)}});break;case 3:xdfn.user.Rights.hasRights("GRPT-TXL-1",function(){var e=Ext.getCmp("PersonAddress");if(e==undefined){f.tabPanel.setActiveTab(f.tabPanel.add(Ext.create("xdfn.person.PersonAddress")))}else{f.tabPanel.setActiveTab(e)}});break}},onInfoCenterItemClick:function(b,a,g,d,h,c){var f=this;switch(d){case 0:xdfn.user.Rights.hasRights("XXZX-GGL-1",function(){var e=Ext.getCmp("Bulletin");if(e==undefined){f.tabPanel.setActiveTab(f.tabPanel.add(Ext.create("xdfn.info.Bulletin")))}else{f.tabPanel.setActiveTab(e)}});break;case 1:xdfn.user.Rights.hasRights("XXZX-ZXZX-1",function(){var e=Ext.getCmp("News");if(e==undefined){f.tabPanel.setActiveTab(f.tabPanel.add(Ext.create("xdfn.info.News")))}else{f.tabPanel.setActiveTab(e)}});break;case 2:xdfn.user.Rights.hasRights("XXZX-ZSK-1",function(){var e=Ext.getCmp("InfoKnowledge");if(e==undefined){f.tabPanel.setActiveTab(f.tabPanel.add(Ext.create("xdfn.info.InfoKnowledge")))}else{f.tabPanel.setActiveTab(e)}});break;case 3:xdfn.user.Rights.hasRights("XXZX-BBS-1",function(){var e=Ext.getCmp("InfoBBS");if(e==undefined){f.tabPanel.setActiveTab(f.tabPanel.add(Ext.create("xdfn.info.InfoBBS")))}else{f.tabPanel.setActiveTab(e)}});break}},onProjectMgrItemClick:function(b,a,g,d,h,c){var f=this;switch(d){case 0:xdfn.user.Rights.hasRights("XMGL-XMZL-1",function(){var e=Ext.getCmp("Projects");if(e==undefined){f.tabPanel.setActiveTab(f.tabPanel.add(Ext.create("xdfn.project.Projects")))}else{f.tabPanel.setActiveTab(e)}});break;case 1:xdfn.user.Rights.hasRights("XMGL-XMSH-1",function(){var e=Ext.getCmp("ProjReview");if(e==undefined){f.tabPanel.setActiveTab(f.tabPanel.add(Ext.create("xdfn.project.ProjReview")))}else{f.tabPanel.setActiveTab(e)}});break;case 2:xdfn.user.Rights.hasRights("XMGL-HTGL-1",function(){var e=Ext.getCmp("Contract");if(e==undefined){f.tabPanel.setActiveTab(f.tabPanel.add(Ext.create("xdfn.project.Contract")))}else{f.tabPanel.setActiveTab(e)}});break;case 3:xdfn.user.Rights.hasRights("XMGL-HKGL-1",function(){var e=Ext.getCmp("ProjMoney");if(e==undefined){f.tabPanel.setActiveTab(f.tabPanel.add(Ext.create("xdfn.project.ProjMoney")))}else{f.tabPanel.setActiveTab(e)}});break;case 4:xdfn.user.Rights.hasRights("XMGL-ZXGL-1",function(){var e=Ext.getCmp("ProjExec");if(e==undefined){f.tabPanel.setActiveTab(f.tabPanel.add(Ext.create("xdfn.project.ProjExec")))}else{f.tabPanel.setActiveTab(e)}});break;case 5:xdfn.user.Rights.hasRights("XMGL-XMTJ-1",function(){var e=Ext.getCmp("ProjStatistics");if(e==undefined){f.tabPanel.setActiveTab(f.tabPanel.add(Ext.create("xdfn.project.ProjStatistics")))}else{f.tabPanel.setActiveTab(e)}});break}},onServiceMgrItemClick:function(b,a,g,d,h,c){var f=this;switch(d){case 0:xdfn.user.Rights.hasRights("FWGL-FWJL-1",function(){var e=Ext.getCmp("Service");if(e==undefined){f.tabPanel.setActiveTab(f.tabPanel.add(Ext.create("xdfn.service.Service")))}else{f.tabPanel.setActiveTab(e)}});break;case 1:xdfn.user.Rights.hasRights("XTGL-CZGG-1",function(){var e=Ext.getCmp("FaxInfo");if(e==undefined){f.tabPanel.setActiveTab(f.tabPanel.add(Ext.create("xdfn.fax.FaxInfo")))}else{f.tabPanel.setActiveTab(e)}});break}},onCustomerMgrItemClick:function(b,a,g,d,h,c){var f=this;switch(d){case 0:xdfn.user.Rights.hasRights("KHGL-KHXX-1",function(){var e=Ext.getCmp("CustomInfo");if(e==undefined){f.tabPanel.setActiveTab(f.tabPanel.add(Ext.create("xdfn.customer.CustomInfo")))}else{f.tabPanel.setActiveTab(e)}});break;case 1:xdfn.user.Rights.hasRights("KHGL-KHJD-1",function(){var e=Ext.getCmp("CustomReceive");if(e==undefined){f.tabPanel.setActiveTab(f.tabPanel.add(Ext.create("xdfn.customer.CustomReceive")))}else{f.tabPanel.setActiveTab(e)}});break}},onSysMgrItemClick:function(b,a,g,d,h,c){var f=this;switch(d){case 0:xdfn.user.Rights.hasRights("XTGL-YGGL-1",function(){var e=Ext.getCmp("EmployeeManager");if(e==undefined){f.tabPanel.setActiveTab(f.tabPanel.add(Ext.create("xdfn.user.EmployeeManager")))}else{f.tabPanel.setActiveTab(e)}});break;case 1:xdfn.user.Rights.hasRights("XTGL-QXGL-1",function(){var e=Ext.getCmp("RightsManager");if(e==undefined){f.tabPanel.setActiveTab(f.tabPanel.add(Ext.create("xdfn.user.RightsManager")))}else{f.tabPanel.setActiveTab(e)}});break;case 2:xdfn.user.Rights.hasRights("XTGL-FBGG-1",function(){var e=Ext.getCmp("InfoBulletin");if(e==undefined){f.tabPanel.setActiveTab(f.tabPanel.add(Ext.create("xdfn.info.InfoBulletin")))}else{f.tabPanel.setActiveTab(e)}});break;case 3:xdfn.user.Rights.hasRights("XTGL-FBZX-1",function(){var e=Ext.getCmp("InfoNews");if(e==undefined){f.tabPanel.setActiveTab(f.tabPanel.add(Ext.create("xdfn.info.InfoNews")))}else{f.tabPanel.setActiveTab(e)}});break}}});