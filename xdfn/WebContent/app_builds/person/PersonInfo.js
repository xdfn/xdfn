Ext.define("xdfn.person.PersonInfo",{extend:"xdfn.person.ui.PersonInfo",initComponent:function(){var a=this;a.callParent(arguments);a.down('button[text="修改资料"]').on("click",a.OnModifyInfoBtnClick,a);a.down('button[text="修改密码"]').on("click",a.OnModifyPasswordBtnClick,a);a.down("form").getForm().load({url:"./userManage.do?method=findById&ID=-1",method:"get",success:function(b,c){var d=c.result.data.V_PHOTO_URL;if(Ext.isEmpty(d)){d="resources/images/photo_p.png"}a.down("#PersonPhoto").add(Ext.create("Ext.Img",{src:d,reanderTo:Ext.fly("PersonPhoto")}))},failure:function(b,c){Ext.Msg.alert("提示","获取个人信息失败！")}})},OnModifyInfoBtnClick:function(a,d,b){var c=this;xdfn.user.Rights.hasRights("GRPT-GRXX-2",function(){var e=a.up("form").getForm();if(!e.isValid()){return}e.submit({clientValidtion:true,waitMsg:"正在提交信息...",waitTitle:"提示",url:"./userManage.do?method=editSelf",success:function(f,g){Ext.Msg.alert("提示","修改成功！",function(){c.down("#PersonPhoto").removeAll();c.down("#PersonPhoto").add(Ext.create("Ext.Img",{src:g.result.photo_url,reanderTo:Ext.fly("PersonPhoto")}))})},failure:function(f,g){Ext.Msg.alert("提示","提交失败！")}})})},OnModifyPasswordBtnClick:function(a,d,b){var c=this;xdfn.user.Rights.hasRights("GRPT-GRXX-3",function(){var g=a.up("form").getForm();if(!g.isValid()){return}var e=c.down('textfield[name="V_NEW_PASSWORD"]').getValue();var f=c.down('textfield[name="V_NEW_PASSWORD2"]').getValue();if(e!=f){Ext.Msg.alert("提示","两次输入新密码不一样！");return}g.submit({clientValidtion:true,waitMsg:"正在提交信息...",waitTitle:"提示",url:"./userManage.do?method=changePwd",success:function(h,i){Ext.Msg.alert("提示","修改密码成功！",function(){h.reset()})},failure:function(h,i){Ext.Msg.alert("提示",i.result.msg,function(){c.down('textfield[name="V_OLD_PASSWORD"]').focus(true)})}})})}});