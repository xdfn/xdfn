Ext.define("Ext.ux.wnl.Wnl",{extend:"Ext.container.Container",alias:"widget.wnl",layout:{type:"fit"},initComponent:function(){var a=this;a.html='<div id="cal"><div id="top">公元&nbsp;<select></select>&nbsp;年&nbsp;<select></select>&nbsp;月&nbsp;&nbsp;&nbsp;&nbsp;农历<span></span>年&nbsp;[&nbsp;<span></span>年&nbsp;]<input type="button" value="今天" title="点击后跳转回今天" style="padding:0px"></div><ul id="wk"><li>一</li><li>二</li><li>三</li><li>四</li><li>五</li><li><b>六</b></li><li><b>日</b></li></ul><div id="cm"></div><div id="bm"><a target="_blank" onMouseDown="return c({"fm":"alop","title":this.innerHTML,"url":this.href,"p1":al_c(this),"p2":1})" href="javascript:void(0)">历史上的今天</a></div></div>',a.callParent(arguments);a.listeners={afterrender:function(b,c){a.createWnl()},resize:function(b,e,d,c){if(a.O!=undefined){a.O.draw(a.I)}}}},createWnl:function(){var w=this;var e=navigator.userAgent.indexOf("MSIE")!=-1&&!window.opera;function k(x){return document.getElementById(x)}function f(x){return document.createElement(x)}var h=[19416,19168,42352,21717,53856,55632,91476,22176,39632,21970,19168,42422,42192,53840,119381,46400,54944,44450,38320,84343,18800,42160,46261,27216,27968,109396,11104,38256,21234,18800,25958,54432,59984,28309,23248,11104,100067,37600,116951,51536,54432,120998,46416,22176,107956,9680,37584,53938,43344,46423,27808,46416,86869,19872,42416,83315,21168,43432,59728,27296,44710,43856,19296,43748,42352,21088,62051,55632,23383,22176,38608,19925,19152,42192,54484,53840,54616,46400,46752,103846,38320,18864,43380,42160,45690,27216,27968,44870,43872,38256,19189,18800,25776,29859,59984,27480,21952,43872,38613,37600,51552,55636,54432,55888,30034,22176,43959,9680,37584,51893,43344,46240,47780,44368,21977,19360,42416,86390,21168,43312,31060,27296,44368,23378,19296,42726,42208,53856,60005,54576,23200,30371,38608,19415,19152,42192,118966,53840,54560,56645,46496,22224,21938,18864,42359,42160,43600,111189,27936,44448,84835];var n="甲乙丙丁戊己庚辛壬癸";var o="子丑寅卯辰巳午未申酉戌亥";var i="鼠牛虎兔龙蛇马羊猴鸡狗猪";var m=["小寒","大寒","立春","雨水","惊蛰","春分","清明","谷雨","立夏","小满","芒种","夏至","小暑","大暑","立秋","处暑","白露","秋分","寒露","霜降","立冬","小雪","大雪","冬至"];var u=[0,21208,43467,63836,85337,107014,128867,150921,173149,195551,218072,240693,263343,285989,308563,331033,353350,375494,397447,419210,440795,462224,483532,504758];var v="日一二三四五六七八九十";var r=["正","二","三","四","五","六","七","八","九","十","十一","腊"];var t="初十廿卅";var b={"0101":"*1元旦节","0214":"情人节","0305":"学雷锋纪念日","0308":"妇女节","0312":"植树节","0315":"消费者权益日","0401":"愚人节","0501":"*1劳动节","0504":"青年节","0601":"国际儿童节","0701":"中国共产党诞辰","0801":"建军节","0910":"中国教师节","1001":"*3国庆节","1224":"平安夜","1225":"圣诞节"};var d={"0101":"*2春节","0115":"元宵节","0505":"*1端午节","0815":"*1中秋节","0909":"重阳节","1208":"腊八节","0100":"除夕"};function c(y){function F(C,G){var L=new Date((31556925974.7*(C-1900)+u[G]*60000)+Date.UTC(1900,0,6,2,5));return(L.getUTCDate())}function E(C){var L,G=348;for(L=32768;L>8;L>>=1){G+=(h[C-1900]&L)?1:0}return(G+H(C))}function I(C){return(n.charAt(C%10)+o.charAt(C%12))}function H(C){if(A(C)){return((h[C-1900]&65536)?30:29)}else{return(0)}}function A(C){return(h[C-1900]&15)}function D(C,G){return((h[C-1900]&(65536>>G))?30:29)}function x(O){var G,L=0,M=0;var C=new Date(1900,0,31);var N=(O-C)/86400000;this.dayCyl=N+40;this.monCyl=14;for(G=1900;G<2050&&N>0;G++){M=E(G);N-=M;this.monCyl+=12}if(N<0){N+=M;G--;this.monCyl-=12}this.year=G;this.yearCyl=G-1864;L=A(G);this.isLeap=false;for(G=1;G<13&&N>0;G++){if(L>0&&G==(L+1)&&this.isLeap==false){--G;this.isLeap=true;M=H(this.year)}else{M=D(this.year,G)}if(this.isLeap==true&&G==(L+1)){this.isLeap=false}N-=M;if(this.isLeap==false){this.monCyl++}}if(N==0&&L>0&&G==L+1){if(this.isLeap){this.isLeap=false}else{this.isLeap=true;--G;--this.monCyl}}if(N<0){N+=M;--G;--this.monCyl}this.month=G;this.day=N+1}function K(C){return C<10?"0"+C:C}function B(G,C){var L=G;return C.replace(/dd?d?d?|MM?M?M?|yy?y?y?/g,function(N){switch(N){case"yyyy":var M="000"+L.getFullYear();return M.substring(M.length-4);case"dd":return K(L.getDate());case"d":return L.getDate().toString();case"MM":return K((L.getMonth()+1));case"M":return L.getMonth()+1}})}function J(G,L){var C;switch(G,L){case 10:C="初十";break;case 20:C="二十";break;case 30:C="三十";break;default:C=t.charAt(Math.floor(L/10));C+=v.charAt(L%10)}return(C)}this.date=y;this.isToday=false;this.isRestDay=false;this.solarYear=B(y,"yyyy");this.solarMonth=B(y,"M");this.solarDate=B(y,"d");this.solarWeekDay=y.getDay();this.solarWeekDayInChinese="星期"+v.charAt(this.solarWeekDay);var z=new x(y);this.lunarYear=z.year;this.shengxiao=i.charAt((this.lunarYear-4)%12);this.lunarMonth=z.month;this.lunarIsLeapMonth=z.isLeap;this.lunarMonthInChinese=this.lunarIsLeapMonth?"闰"+r[z.month-1]:r[z.month-1];this.lunarDate=z.day;this.showInLunar=this.lunarDateInChinese=J(this.lunarMonth,this.lunarDate);if(this.lunarDate==1){this.showInLunar=this.lunarMonthInChinese+"月"}this.ganzhiYear=I(z.yearCyl);this.ganzhiMonth=I(z.monCyl);this.ganzhiDate=I(z.dayCyl++);this.jieqi="";this.restDays=0;if(F(this.solarYear,(this.solarMonth-1)*2)==B(y,"d")){this.showInLunar=this.jieqi=m[(this.solarMonth-1)*2]}if(F(this.solarYear,(this.solarMonth-1)*2+1)==B(y,"d")){this.showInLunar=this.jieqi=m[(this.solarMonth-1)*2+1]}if(this.showInLunar=="清明"){this.showInLunar="清明节";this.restDays=1}this.solarFestival=b[B(y,"MM")+B(y,"dd")];if(typeof this.solarFestival=="undefined"){this.solarFestival=""}else{if(/\*(\d)/.test(this.solarFestival)){this.restDays=parseInt(RegExp.$1);this.solarFestival=this.solarFestival.replace(/\*\d/,"")}}this.showInLunar=(this.solarFestival=="")?this.showInLunar:this.solarFestival;this.lunarFestival=d[this.lunarIsLeapMonth?"00":K(this.lunarMonth)+K(this.lunarDate)];if(typeof this.lunarFestival=="undefined"){this.lunarFestival=""}else{if(/\*(\d)/.test(this.lunarFestival)){this.restDays=(this.restDays>parseInt(RegExp.$1))?this.restDays:parseInt(RegExp.$1);this.lunarFestival=this.lunarFestival.replace(/\*\d/,"")}}if(this.lunarMonth==12&&this.lunarDate==D(this.lunarYear,12)){this.lunarFestival=d["0100"];this.restDays=1}this.showInLunar=(this.lunarFestival=="")?this.showInLunar:this.lunarFestival;this.showInLunar=(this.showInLunar.length>4)?this.showInLunar.substr(0,2)+"...":this.showInLunar}var g=(function(){var B={};B.lines=0;B.dateArray=new Array(42);function z(C){return(((C%4===0)&&(C%100!==0))||(C%400===0))}function y(C,D){return[31,(z(C)?29:28),31,30,31,30,31,31,30,31,30,31][D]}function A(C,D){C.setDate(C.getDate()+D);return C}function x(C){var D=0;var G=new c(new Date(C.solarYear,C.solarMonth-1,1));var F=(G.solarWeekDay-1==-1)?6:G.solarWeekDay-1;B.lines=Math.ceil((F+y(C.solarYear,C.solarMonth-1))/7);for(var E=0;E<B.dateArray.length;E++){if(G.restDays!=0){D=G.restDays}if(D>0){G.isRest=true}if(F-->0||G.solarMonth!=C.solarMonth){B.dateArray[E]=null;continue}var H=new c(new Date());if(G.solarYear==H.solarYear&&G.solarMonth==H.solarMonth&&G.solarDate==H.solarDate){G.isToday=true}B.dateArray[E]=G;G=new c(A(G.date,1));D--}}return{init:function(C){x(C)},getJson:function(){return B}}})();var a=(function(){var x=k("top").getElementsByTagName("SELECT")[0];var z=k("top").getElementsByTagName("SELECT")[1];var J=k("top").getElementsByTagName("SPAN")[0];var E=k("top").getElementsByTagName("SPAN")[1];var y=k("top").getElementsByTagName("INPUT")[0];function H(C){J.innerHTML=C.ganzhiYear;E.innerHTML=C.shengxiao}function F(C){x[C.solarYear-1901].selected=true;z[C.solarMonth-1].selected=true}function A(){var C=x.value;var L=z.value;var G=new c(new Date(C,L-1,1));g.init(G);j.draw();if(this==x){G=new c(new Date(C,3,1));J.innerHTML=G.ganzhiYear;E.innerHTML=G.shengxiao}var K=new c(new Date());y.style.visibility=(C==K.solarYear&&L==K.solarMonth)?"hidden":"visible"}function I(){var C=new c(new Date());H(C);F(C);g.init(C);j.draw();y.style.visibility="hidden"}function D(C,L){for(var G=1901;G<2050;G++){var K=f("OPTION");K.value=G;K.innerHTML=G;if(G==C){K.selected="selected"}x.appendChild(K)}for(var G=1;G<13;G++){var K=f("OPTION");K.value=G;K.innerHTML=G;if(G==L){K.selected="selected"}z.appendChild(K)}x.onchange=A;z.onchange=A}function B(G){D(G.solarYear,G.solarMonth);J.innerHTML=G.ganzhiYear;E.innerHTML=G.shengxiao;y.onclick=I;var C=new c(new Date());y.style.visibility=(G.solarYear===C.solarYear&&G.solarMonth===C.solarMonth&&G.solarDate===C.solarDate)?"hidden":"visible"}return{init:function(C){B(C)},reset:function(C){F(C)}}})();var j=(function(){function x(B){var F=g.getJson();var C=F.dateArray;k("cm").style.height=F.lines*38+2+"px";k("cm").innerHTML="";for(var E=0;E<C.length;E++){var A=0;if(C[E]==null){A++;continue}var z=f("DIV");if(B){if(B.solarDate===C[E].solarDate){z.style.cssText="border:1px solid #a5b9da;background:#c1d9ff"}}else{if(C[E].isToday){z.style.cssText="border:1px solid #a5b9da;background:#c1d9ff"}}z.className="cell";var J=Ext.query("#wk li:first-child");var H=Ext.get(J[0]).getWidth();z.style.width=H;z.style.left=(E%7)*H+"px";z.style.top=Math.floor(E/7)*38+2+"px";var D=f("DIV");D.className="so";D.style.color=((E%7)>4||C[E].isRest)?"#c60b02":"#313131";D.innerHTML=C[E].solarDate;z.appendChild(D);var y=f("DIV");y.style.color="#666";y.innerHTML=C[E].showInLunar;z.appendChild(y);z.onmouseover=(function(G){return function(K){s.show({dateIndex:G,cell:this})}})(E);z.onmouseout=function(){s.hide()};k("cm").appendChild(z)}var I=f("DIV");I.id="fd";k("cm").appendChild(I);s.init(I)}return{draw:function(y){x(y)}}})();var s=(function(){var A;function y(D,F){if(arguments.length>1){var G=/([.*+?^=!:${}()|[\]\/\\])/g,C="{".replace(G,"\\$1"),E="}".replace(G,"\\$1");var B=new RegExp("#"+C+"([^"+C+E+"]+)"+E,"g");if(typeof(F)=="object"){return D.replace(B,function(J,H){var I=F[H];return typeof(I)=="undefined"?"":I})}}return D}function x(E){var B=g.getJson().dateArray[E.dateIndex];var C=E.cell;var D="#{solarYear}&nbsp;年&nbsp;#{solarMonth}&nbsp;月&nbsp;#{solarDate}&nbsp;日&nbsp;#{solarWeekDayInChinese}";D+="<br><b>农历&nbsp;#{lunarMonthInChinese}月#{lunarDateInChinese}</b>";D+="<br>#{ganzhiYear}年&nbsp;#{ganzhiMonth}月&nbsp;#{ganzhiDate}日";if(B.solarFestival!=""||B.lunarFestival!=""||B.jieqi!=""){D+="<br><b>#{lunarFestival} #{solarFestival} #{jieqi}</b>"}A.innerHTML=y(D,B);A.style.top=C.offsetTop+C.offsetHeight-5+"px";A.style.left=C.offsetLeft+C.offsetWidth-5+"px";A.style.display="block"}function z(){A.style.display="none"}return{show:function(B){x(B)},hide:function(){z()},init:function(B){A=B}}})();var q=(function(){var x=k("bm").getElementsByTagName("A")[0];function y(z){x.href="http://baike.baidu.com/list-php/dispose/searchword.php?word="+z.solarMonth+"%D4%C2"+z.solarDate+"%C8%D5&pic=1"}return{setLink:function(z){y(z)}}})();var l=new c(new Date());var p=(function(){if(window.op_calendar&&window.op_calendar.year&&window.op_calendar.month&&window.op_calendar.day){var x=new Date([window.op_calendar.year,window.op_calendar.month,window.op_calendar.day].join("/"));if((x.toString().toLowerCase()!=="invalid date")&&(Object.prototype.toString.apply(x).toLowerCase()==="[object date]")){return new c(x)}else{return l}}else{return l}})();a.init(p);if(e&&window.attachEvent){window.attachEvent("onload",function(){a.reset(p)})}g.init(p);j.draw(p);q.setLink(l);w.O=j;w.I=p}});