Ext.define("xdfn.project.ProjApply",{extend:"xdfn.project.ui.ProjApply",grid:null,initComponent:function(){var a=this;a.applyStore=Ext.create("xdfn.project.store.ProjApplyJsonStore");a.callParent(arguments);a.down('button[text="项目报送"]').on("click",a.OnProjApplyBtnClick,a);a.down('button[text="导出"]').on("click",a.OnExportApplyBtnClick,a)},OnProjApplyBtnClick:function(a,g,b){var d=this,c=a.up("gridpanel"),h=d.grid.getSelectionModel(),f=h.getSelection();xdfn.user.Rights.hasRights("XMGL-XMZL-6",function(){if(f.length>0){var e=Ext.create("xdfn.project.ProjApplyWindow",{url:"./projectMgr.do?method=addProApply",grid:c,ID:f[0].get("ID_VIEW")});e.down("form").getForm().setValues({V_OLD_TYPE:f[0].get("V_PRO_PHASE_VIEW")});e.show()}else{Ext.Msg.alert("提示","请先选择相应的项目！")}})},OnExportApplyBtnClick:function(a,d,b){var c=this;xdfn.user.Rights.hasRights("XMGL-XMZL-7",function(){c.applyStore.load({limit:c.applyStore.getTotalCount(),scope:this,callback:function(g,f,h){var e=Ext.ux.exporter.Exporter.exportGrid(a.up("gridpanel"),"excel",{title:"项目报送表"});document.location="data:application/vnd.ms-excel;base64,"+Ext.ux.exporter.Base64.encode(e)}})})}});