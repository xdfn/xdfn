Ext.define("xdfn.project.ProjStatistics",{extend:"xdfn.project.ui.ProjStatistics",initComponent:function(){var a=this;a.statStore=Ext.create("xdfn.project.store.ProjStatJsonStore");a.pieStore=Ext.create("xdfn.project.store.ProjStatJsonStore");a.pieStore.getProxy().setReader({type:"json",root:"pie"});a.callParent(arguments);a.gridPanel=a.down('panel[title="统计列表"]');a.chartPanel=a.down('panel[title="统计图表"]');a.chartPanel.add(Ext.create("xdfn.project.chart.ProjPhaseStatLineChart",{store:a.statStore}));a.down('button[text="统计"]').on("click",a.OnStatBtnClick,a);a.down('button[text="重置"]').on("click",a.OnResetBtnClick,a);a.down('button[text="导出"]').on("click",a.OnExportStatBtnClick,a);a.down('menuitem[text="折线图"]').on("click",a.OnLineChartBtnClick,a);a.down('menuitem[text="柱状图"]').on("click",a.OnColumnChartBtnClick,a);a.down('menuitem[text="条状图"]').on("click",a.OnBarChartBtnClick,a);a.down('menuitem[text="饼状图"]').on("click",a.OnPieChartBtnClick,a)},OnStatBtnClick:function(a,d,b){var c=this;xdfn.user.Rights.hasRights("100002011",function(){var e=a.up("form").getForm();if(!e.isValid()){return}e.submit({waitMsg:"正在统计...",waitTitle:"提示",url:"./app/data/grid_proj_stat.json",success:function(f,g){c.down("tabpanel").setActiveTab(c.chartPanel);c.statStore.loadData(g.result.data);c.pieStore.loadData(g.result.pie);switch(f.findField("V_PRO_STAT_OPTS").getChecked()[0].getGroupValue()){case"1":c.gridPanel.removeAll();c.gridPanel.add(Ext.create("xdfn.project.grid.ProjStatTypeGrid",{store:c.statStore}));break;case"2":break;case"3":break;case"4":c.gridPanel.removeAll();c.gridPanel.add(Ext.create("xdfn.project.grid.ProjStatPhaseGrid",{store:c.statStore}));break}},failure:function(f,g){c.statStore.loadData([])}});Ext.apply(c.statStore.getProxy(),{extraParams:e.getValues()})})},OnResetBtnClick:function(a,c,b){a.up("form").getForm().reset()},OnLineChartBtnClick:function(a,d,b){var c=this;c.chartPanel.removeAll();c.chartPanel.add(Ext.create("xdfn.project.chart.ProjPhaseStatLineChart",{store:c.statStore}))},OnColumnChartBtnClick:function(a,d,b){var c=this;c.chartPanel.removeAll();c.chartPanel.add(Ext.create("xdfn.project.chart.ProjPhaseStatColumnChart",{store:c.statStore}))},OnBarChartBtnClick:function(a,d,b){var c=this;c.chartPanel.removeAll();c.chartPanel.add(Ext.create("xdfn.project.chart.ProjPhaseStatBarChart",{store:c.statStore}))},OnPieChartBtnClick:function(a,d,b){var c=this;c.chartPanel.removeAll();c.chartPanel.add(Ext.create("xdfn.project.chart.ProjPhaseStatPieChart",{store:c.pieStore}))},OnExportStatBtnClick:function(a,c,b){Ext.Msg.alert("提示","导出为excel文件！")}});