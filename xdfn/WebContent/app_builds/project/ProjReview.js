Ext.define("xdfn.project.ProjReview",{extend:"xdfn.project.ui.ProjReview",initComponent:function(){var a=this;a.reviewStore=Ext.create("xdfn.project.store.ProjApplyJsonStore",{autoLoad:true,proxy:{type:"ajax",url:"./projectMgr.do?method=getProApplyAuditList",reader:{type:"json",root:"data"}}});a.callParent(arguments);a.down('button[text="审核项目"]').on("click",a.OnReviewProjectBtnClick,a);a.down('button[text="删除审核"]').on("click",a.OnDeleteReviewBtnClick,a);a.down('button[text="查找"]').on("click",a.OnSearchBtnClick,a);a.down('button[text="重置"]').on("click",a.OnResetBtnClick,a);a.down('button[text="导出"]').on("click",a.OnExportReviewBtnClick,a)},OnReviewProjectBtnClick:function(a,g,b){var d=this,c=a.up("gridpanel"),h=c.getSelectionModel(),f=h.getSelection();xdfn.user.Rights.hasRights("XMGL-XMSH-2",function(){if(f.length>0){if(f[0].get("V_REVIEW_STATUS_VIEW")=="未审核"){var e=Ext.create("xdfn.project.ProjReviewWindow",{url:"./projectMgr.do?method=proApplyAudit",ID:f[0].get("ID_VIEW"),grid:c});e.down("form").getForm().setValues({V_PRO_NAME:f[0].get("V_PRO_NAME_VIEW"),V_OLD_TYPE:f[0].get("V_OLD_TYPE_VIEW"),V_TYPE:f[0].get("V_TYPE_VIEW"),V_REVIEW_MEMO:f[0].get("V_REVIEW_MEMO_VIEW")});e.show()}else{Ext.Msg.alert("提示","该项已经审核过了！")}}else{Ext.Msg.alert("提示","请选择要审核的项目！")}})},OnDeleteReviewBtnClick:function(b,h,c){var f=this,d=b.up("gridpanel"),a=d.getStore(),i=d.getSelectionModel(),g=i.getSelection();xdfn.user.Rights.hasRights("XMGL-XMSH-3",function(){if(g.length>0){Ext.MessageBox.confirm("提示","确定删除该审核项吗？",function(e){if(e=="yes"){Ext.Ajax.request({url:"./projectMgr.do?method=deleteApplyAudit",method:"get",params:{ID:g[0].get("ID_VIEW")},success:function(j,m){var k=a.indexOf(g[0]);a.remove(g);var l=a.getCount();if(l>0){i.select((k==l)?--k:k)}},failure:function(j,k){Ext.Msg.alert("提示","删除失败！")}})}})}else{Ext.Msg.alert("提示","请选择要删除的审核项！")}})},OnSearchBtnClick:function(a,f,b){var d=this;var c=a.up("form").getForm();if(!c.isValid()){return}Ext.apply(d.reviewStore.getProxy(),{extraParams:c.getValues()});d.reviewStore.load()},OnResetBtnClick:function(a,c,b){a.up("form").getForm().reset()},OnExportReviewBtnClick:function(a,d,b){var c=this;xdfn.user.Rights.hasRights("XMGL-XMSH-4",function(){c.reviewStore.load({limit:c.reviewStore.getTotalCount(),scope:this,callback:function(g,f,h){var e=Ext.ux.exporter.Exporter.exportGrid(a.up("gridpanel"),"excel",{title:"项目审核表"});document.location="data:application/vnd.ms-excel;base64,"+Ext.ux.exporter.Base64.encode(e)}})})}});